<% content_for :title, "Search Results - Alchefeast" %>

<div class="container-fluid">

  <div class="container">
    <!-- Search Header -->
    <div class="row mb-4">
      <div class="col-12">
        <h1 class="display-6 fw-bold text-primary">
          <i class="bi bi-search me-2"></i>Search Results
        </h1>

        <div class="mb-3">
          <% if @query.present? %>
            <p class="lead">
              Showing results for: <strong>"<%= @query %>"</strong>
            </p>
          <% end %>

          <% if @ingredients.present? %>
            <p class="lead">
              <% if @search_type == "all" %>
                Recipes that contain <strong>ALL</strong> of these ingredients:
              <% else %>
                Recipes that contain <strong>ANY</strong> of these ingredients:
              <% end %>
              <% @ingredients.each_with_index do |ingredient, index| %>
                <span class="badge bg-success me-1"><%= ingredient %></span><%= ',' if index < @ingredients.length - 1 %>
              <% end %>
            </p>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Search Form -->
    <div class="row mb-4">
      <div class="col-12">
        <%= render 'search_form', 
            title: "Refine Your Search", 
            show_categories: false, 
            show_browse_all: true,
            turbo_frame_context: false %>
      </div>
    </div>

    <!-- Search Results -->
    <div class="row">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4 class="mb-0">
            <i class="bi bi-grid-3x3-gap me-2"></i>
            <%= @recipes.total_count %> Recipe<%= 's' if @recipes.total_count != 1 %> Found
          </h4>

          <div class="d-flex align-items-center gap-3">
            <% if @recipes.respond_to?(:current_page) && @recipes.total_count > 0 %>
              <small class="text-muted">
                Showing <%= @recipes.offset_value + 1 %>-<%= [@recipes.offset_value + @recipes.limit_value, @recipes.total_count].min %> 
                of <%= @recipes.total_count %> recipes
              </small>
            <% end %>
            
            <% if @recipes.any? %>
              <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-secondary btn-sm active">
                  <i class="bi bi-grid-3x3-gap"></i> Grid
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm">
                  <i class="bi bi-list"></i> List
                </button>
              </div>
            <% end %>
          </div>
        </div>

        <% if @recipes.any? %>
          <div class="row">
            <% @recipes.each do |recipe| %>
              <div class="col-xl-4 col-lg-6 col-md-6 mb-4">
                <%= render 'recipe_card', recipe: recipe, search_ingredients: @ingredients %>
              </div>
            <% end %>
          </div>
          
          <!-- Pagination -->
          <% if @recipes.respond_to?(:current_page) %>
            <div class="row">
              <div class="col-12 d-flex justify-content-center mt-4">
                <%= paginate @recipes, window: 2, 
                    params: { q: @query, ingredients: @ingredients&.join(','), search_type: @search_type, category: params[:category] }.compact %>
              </div>
            </div>
          <% end %>
        <% else %>
          <!-- No Results -->
          <div class="text-center py-5">
            <div class="mb-4">
              <i class="bi bi-emoji-frown display-1 text-muted"></i>
            </div>
            <h3 class="text-muted mb-3">No recipes found</h3>
            <p class="text-muted mb-4">
              We couldn't find any recipes matching your search criteria.
              <br>Try adjusting your search terms or browse all recipes.
            </p>

            <div class="d-flex justify-content-center gap-3">
              <%= link_to "Browse All Recipes", recipes_path, class: "btn btn-primary" %>
              <%= link_to "Back to Home", root_path, class: "btn btn-outline-secondary" %>
            </div>

            <!-- Search Suggestions -->
            <div class="mt-4">
              <h5 class="text-muted">Search Suggestions:</h5>
              <div class="d-flex justify-content-center flex-wrap gap-2 mt-3">
                <%= link_to search_recipes_path(q: "pasta"), class: "btn btn-outline-primary btn-sm" do %>
                  <i class="bi bi-search me-1"></i>Pasta Recipes
                <% end %>
                <%= link_to search_recipes_path(q: "chicken"), class: "btn btn-outline-primary btn-sm" do %>
                  <i class="bi bi-search me-1"></i>Chicken Recipes
                <% end %>
                <%= link_to search_recipes_path(ingredients: "tomatoes,onions"), class: "btn btn-outline-success btn-sm" do %>
                  <i class="bi bi-basket2 me-1"></i>Tomatoes & Onions
                <% end %>
                <%= link_to search_recipes_path(ingredients: "eggs,cheese"), class: "btn btn-outline-success btn-sm" do %>
                  <i class="bi bi-basket2 me-1"></i>Eggs & Cheese
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>

</div>

<!-- Recipe Modal Frame -->
<%= turbo_frame_tag "recipe_modal" do %>
  <!-- Modal content will be loaded here -->
<% end %>

<style>
.recipe-card {
  transition: transform 0.2s ease-in-out;
}

.recipe-card:hover {
  transform: translateY(-5px);
}
</style>
