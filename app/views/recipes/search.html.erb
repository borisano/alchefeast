<% content_for :title, "Search Results - Alchefeast" %>

<div class="container-fluid">

  <div class="container">
    <!-- Search Header -->
    <div class="row mb-4">
      <div class="col-12">
        <h1 class="display-6 fw-bold text-primary">
          <i class="bi bi-search me-2"></i>Search Results
        </h1>

        <div class="mb-3">
          <% if @query.present? %>
            <p class="lead">
              Showing results for: <strong>"<%= @query %>"</strong>
            </p>
          <% end %>

          <% if @ingredients.present? %>
            <p class="lead">
              <% if @search_type == "all" %>
                Recipes that contain <strong>ALL</strong> of these ingredients:
              <% else %>
                Recipes that contain <strong>ANY</strong> of these ingredients:
              <% end %>
              <% @ingredients.each_with_index do |ingredient, index| %>
                <span class="badge bg-success me-1"><%= ingredient %></span><%= ',' if index < @ingredients.length - 1 %>
              <% end %>
            </p>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Search Form -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h5 class="card-title mb-3">
              <i class="bi bi-funnel me-2"></i>Refine Your Search
            </h5>

            <form action="<%= search_recipes_path %>" method="get">
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label for="search_query" class="form-label">Recipe Name</label>
                  <input type="text" class="form-control" id="search_query" name="q"
                         value="<%= @query %>" placeholder="e.g., pasta, chicken curry">
                </div>

                <div class="col-md-4 mb-3">
                  <label for="search_ingredients" class="form-label">Ingredients</label>
                  <input type="text" class="form-control" id="search_ingredients" name="ingredients"
                         value="<%= @ingredients.join(', ') if @ingredients.present? %>"
                         placeholder="e.g., chicken, tomatoes, onions">
                  <div class="form-text">Separate multiple ingredients with commas</div>
                </div>

                <div class="col-md-4 mb-3">
                  <label for="search_type" class="form-label">Search Type</label>
                  <select class="form-select" id="search_type" name="search_type">
                    <option value="all" <%= 'selected' if @search_type == 'all' %>>
                      Must have ALL ingredients
                    </option>
                    <option value="any" <%= 'selected' if @search_type == 'any' %>>
                      Can have ANY ingredients
                    </option>
                  </select>
                  <div class="form-text">How to match ingredients</div>
                </div>
              </div>

              <button type="submit" class="btn btn-primary">
                <i class="bi bi-search me-2"></i>Search Recipes
              </button>
              <%= link_to "Clear All", search_recipes_path, class: "btn btn-outline-secondary ms-2" %>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Search Results -->
    <div class="row">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4 class="mb-0">
            <i class="bi bi-grid-3x3-gap me-2"></i>
            <%= @recipes.length %> Recipe<%= 's' if @recipes.length != 1 %> Found
          </h4>

          <% if @recipes.any? %>
            <div class="btn-group" role="group">
              <button type="button" class="btn btn-outline-secondary btn-sm active">
                <i class="bi bi-grid-3x3-gap"></i> Grid
              </button>
              <button type="button" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-list"></i> List
              </button>
            </div>
          <% end %>
        </div>

        <% if @recipes.any? %>
          <div class="row">
            <% @recipes.each do |recipe| %>
              <div class="col-xl-4 col-lg-6 col-md-6 mb-4">
                <%= render 'recipe_card', recipe: recipe, search_ingredients: @ingredients %>
              </div>
            <% end %>
          </div>
        <% else %>
          <!-- No Results -->
          <div class="text-center py-5">
            <div class="mb-4">
              <i class="bi bi-emoji-frown display-1 text-muted"></i>
            </div>
            <h3 class="text-muted mb-3">No recipes found</h3>
            <p class="text-muted mb-4">
              We couldn't find any recipes matching your search criteria.
              <br>Try adjusting your search terms or browse all recipes.
            </p>

            <div class="d-flex justify-content-center gap-3">
              <%= link_to "Browse All Recipes", recipes_path, class: "btn btn-primary" %>
              <%= link_to "Back to Home", root_path, class: "btn btn-outline-secondary" %>
            </div>

            <!-- Search Suggestions -->
            <div class="mt-4">
              <h5 class="text-muted">Search Suggestions:</h5>
              <div class="d-flex justify-content-center flex-wrap gap-2 mt-3">
                <%= link_to search_recipes_path(q: "pasta"), class: "btn btn-outline-primary btn-sm" do %>
                  <i class="bi bi-search me-1"></i>Pasta Recipes
                <% end %>
                <%= link_to search_recipes_path(q: "chicken"), class: "btn btn-outline-primary btn-sm" do %>
                  <i class="bi bi-search me-1"></i>Chicken Recipes
                <% end %>
                <%= link_to search_recipes_path(ingredients: "tomatoes,onions"), class: "btn btn-outline-success btn-sm" do %>
                  <i class="bi bi-basket2 me-1"></i>Tomatoes & Onions
                <% end %>
                <%= link_to search_recipes_path(ingredients: "eggs,cheese"), class: "btn btn-outline-success btn-sm" do %>
                  <i class="bi bi-basket2 me-1"></i>Eggs & Cheese
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>

</div>

<style>
.recipe-card {
  transition: transform 0.2s ease-in-out;
}

.recipe-card:hover {
  transform: translateY(-5px);
}
</style>
