<div class="card h-100 shadow-sm recipe-card">
  <div class="position-relative">
    <img src="<%= recipe.image_url %>" class="card-img-top" alt="<%= recipe.title %>" 
         style="height: 200px; object-fit: cover;">
    
    <!-- Category Badge -->
    <% if recipe.category.present? %>
      <span class="position-absolute top-0 start-0 m-2 badge bg-primary">
        <%= recipe.category %>
      </span>
    <% end %>
  </div>
  
  <div class="card-body d-flex flex-column">
    <h5 class="card-title mb-2"><%= recipe.title %></h5>
    <p class="card-text text-muted small flex-grow-1">Delicious recipe to try!</p>
    
    <!-- Matching Ingredients (for search results) -->
    <% if local_assigns[:search_ingredients].present? && recipe.ingredients.any? %>
      <% matching_ingredients = recipe.ingredients.select { |ing| search_ingredients.map(&:downcase).include?(ing.name.downcase) } %>
      <% if matching_ingredients.any? %>
        <div class="mb-3">
          <h6 class="small text-success mb-1">
            <i class="bi bi-check-circle me-1"></i>Matching Ingredients:
          </h6>
          <div class="d-flex flex-wrap gap-1">
            <% matching_ingredients.each do |ingredient| %>
              <span class="badge bg-success small"><%= ingredient.name.capitalize %></span>
            <% end %>
          </div>
        </div>
      <% end %>
    <% end %>
    
    <!-- Recipe Stats -->
    <div class="row g-1 mb-3 small">
      <% if recipe.total_time.present? %>
        <div class="col-6">
          <i class="bi bi-clock text-primary me-1"></i><%= recipe.total_time %>min
        </div>
      <% end %>
      <% if recipe.ratings.present? %>
        <div class="col-6">
          <i class="bi bi-star-fill text-warning me-1"></i><%= recipe.ratings %>
        </div>
      <% end %>
      <div class="col-6">
        <i class="bi bi-heart text-danger me-1"></i>Popular
      </div>
    </div>
    
    <!-- Ingredients Preview (for all recipes page) -->
    <% if local_assigns[:search_ingredients].blank? && recipe.ingredients.any? %>
      <div class="mb-3">
        <h6 class="small text-muted mb-1">Key Ingredients:</h6>
        <div class="d-flex flex-wrap gap-1">
          <% recipe.ingredients.limit(3).each do |ingredient| %>
            <span class="badge bg-light text-dark small"><%= ingredient.name %></span>
          <% end %>
          <% if recipe.ingredients.count > 3 %>
            <span class="badge bg-secondary small">+<%= recipe.ingredients.count - 3 %> more</span>
          <% end %>
        </div>
      </div>
    <% end %>
    
    <div class="mt-auto">
      <%= link_to "View Recipe", recipe_path(recipe.id), class: "btn btn-primary w-100" %>
    </div>
  </div>
</div>
